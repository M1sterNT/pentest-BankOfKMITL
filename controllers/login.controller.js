const Validator = require("validatorjs");
const admin = require('firebase-admin');

const serviceAccount = require("./../bankofkmitl.json");
admin.initializeApp({
  credential: admin.credential.cert(serviceAccount),
  databaseURL: "https://bankofkmitl.firebaseio.com"
});

const db = admin.firestore();

const Login = (req, res) => {
  const rules = {
    pin: "required"
  };

  let validation = new Validator(req.body, rules);
  validation.passes(async function() {
    let refDB = await db.collection("pin").doc("password").get();
    if(req.body.pin == refDB.data().pin){
        res.status(200).json({ message: "true" })
    }else{
        res.status(200).json({ message: "false" })
    }
  });
  
  validation.fails(function () {
    res.status(200).json(validation.errors)
  })
};

module.exports = Login;